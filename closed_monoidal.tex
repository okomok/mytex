\documentclass{article}
\usepackage{tikz,strd}

\begin{document}

\newcommand{\myf}[1]{
    \strdline{#1}{fz}
    \strdleft{fz}{fy}
    \strdright{fz}{fx}
    \strdcelllabel{fz End}{f}
    \strdlinelabel{fz}{}{Z}
    \strdlinelabel{fx}{}{X}
}

\newcommand{\mybf}[1]{
    \strdline{#1}{bfyz}
    \strdscale{2}{2}{ \strdbijection{bfyz}{bfbox} }
    \myf{bfyz}
    \strdline{fx}{bfx}
    \strdihomlabel{bfyz}{Y}{Z}
    \strdlinelabel{bfx}{}{X}
}

\newcommand{\myh}[1]{
    \strdline{#1}{hx'}
    \strdcelllabel{hx' Start}{h}
    \strdlinelabel{hx'}{}{X'}
}
    

% syntax

\strdpreview{
    \strdgathered{
        \strdline{\strdorigin}{xy}
        \strdihomlabel{xy}{X}{Y}
    }
    \iffalse
    \strddefeq
    \strdgathered{
        \strdline{\strdorigin}{xy}
        \strdlinelabel{xy}{}{[X,Y]}
    }
    \fi
    \strddefeq
    \strdgathered{
        \strdline{\strdorigin}{xy}
        \strdstartlabel{xy}{(\mathcal{V})}
        \strdlinelabel{xy}{X}{Y}
    }
    \iffalse
    \strddefeq
    \strdgathered{
        \strdline{\strdorigin}{xy}
        \strdstartlabel{xy}{(\mathcal{V})(X,Y)}
    }
    \fi
 }

% bijections
\strdpreview{
    \strdgathered{
        \mybf{\strdorigin}
        \strdlinelabel{fy}{}{Y}
    }
}

\strdpreview{
    \strdgathered{
        \strdassign{mygb}{
            \strdassign{myg}{
                \strdline{\strdorigin}{yz}
                \strdright{yz}{x}
                \strdcelllabel{yz End}{g}
                \strdihomlabel{yz}{Y}{Z}
                \strdlinelabel{x}{}{X}
                \strdcoord{yz Start}{yzc}
            }
            \strdreverse{\strdline{yzc}{z}}
            \strdscale{2}{2}{ \strdbijection{yzc}{bj} }
            \strdparallel{bj}{xy}
            \strdlinelabel{z}{}{Z}
            \strdlinelabel{xy Left}{}{Y}
            \strdlinelabel{xy Right}{}{X}
        }
    }
}

% naturality of X

\strdpreview{
    \strdgathered{
        \mybf{\strdorigin}
        \myh{bfx}
        \strdlinelabel{fy}{}{Y}
    }
    =
    \strdgathered{
        \strdline{\strdorigin}{yz}
        \myf{yz}
        \myh{fx}
        \strdline{fy}{y2}
        \strdscale{2}{3}{\strdbijection{yz}{box}}
        \strdline{hx'}{x'}
        \strdlinelabel{x'}{}{X'}
        \strdihomlabel{yz}{Y}{Z}
        \strdlinelabel{fy End}{}{Y}
    }
}

\strdpreview{
    \strdgathered{
        \strdline{\strdorigin}{z}
        \strdlinelabel{z}{}{Z}
        \strdline{z}{yz}
        \strdihomlabel{yz}{Y}{Z}
        \strdcelllabel{yz End}{g}
        \strdright{yz}{x}
        \strdlinelabel{x}{}{X}
        \strdscale{2}{2}{\strdbijection{z}{zbox}}
        \strdparallel{zbox}{yx}
        \strdlinelabel{yx Right}{}{X}
        \strdcelllabel{yx Right End}{h}
        \strdline{yx Right}{x'}
        \strdlinelabel{x'}{}{X'}
        \strdline{yx Left}{y}
        \strdlinelabel{y Start}{}{Y}
    }
    =
    \strdgathered{
        \strdline{\strdorigin}{z}
        \strdlinelabel{z}{}{Z}
        \strdline{z}{yz}
        \strdihomlabel{yz}{Y}{Z}
        \strdcelllabel{yz End}{g}
        \strdright{yz}{x}
        \strdlinelabel{x}{}{X}
        \strdcelllabel{x End}{h}
        \strdline{x}{x'}
        \strdscale{2}{3}{\strdbijection{z}{zbox}}
        \strdlinelabel{x'}{}{X'}
        \strdparallel{zbox}{yx'}
        \strdlinelabel{yx' Left}{}{Y}
        \strdlinelabel{yx' Right}{}{X'}
    }
}

% bijection functoriality
\strdpreview{
    \strdgathered{
        \strdline{\strdorigin}{yz'}
        \strdihomlabel{yz'}{Y}{Z'}
        \newcommand{\myl}{
            \strdxscale{2}{\strdleft{yz'}{yz}}
            \strdline{yz}{z}
            \strdleft{z}{y}
            \strdright{z}{x}
            \strdscale{2}{2}{\strdbijection{yz}{lbox}}
        }
        \strdidentity{
            \myl
            \strdline{x}{x2}
            \strdihomlabel{yz}{Y}{Z}
            \strdlinelabel{z}{}{Z}
            \strdlinelabel{y}{}{Y}
            \strdlinelabel{x}{}{X}
            \strdlinelabel{x2}{}{X}
            \strdcelllabel{z End}{f}
        }
        \strdflip{
            \myl
            \strdline{y}{x2}
            \strdihomlabel{yz}{Z}{Z'}
            \strdlinelabel{z}{}{Z'}
            \strdlinelabel{y}{}{X'}
            \strdlinelabel{x}{}{Z}
            \strdlinelabel{x2}{}{X'}
            \strdcelllabel{z End}{g}
        }
    }
    =
    \strdgathered{
        \strdline{\strdorigin}{yz'}
        \strdihomlabel{yz'}{Y}{Z'}
        \strdline{yz'}{z'}
        \strdlinelabel{z'}{}{Z'}
        \strdcelllabel{z' End}{g}
        \strdleft{z'}{z}
        \strdlinelabel{z}{}{Z}
        \strdleft{z}{y}
        \strdlinelabel{y}{}{Y}
        \strdright{z}{x}
        \strdlinelabel{x}{}{X}
        \strdxscale{1}{\strdright{z'}{x'}}
        \strdline{x'}{x'2}
        \strdlinelabel{x'2 Start}{}{X'}
        \strdline{x}{x2}
        \strdlinelabel{x2}{}{X}
        \strdline{x'2}{x'3}
        \strdlinelabel{x'3}{}{X'}
        \strdyscale{3}{
            \strdpathwith{strd bijection}{
                \strdxscale{3}{\strdbypassleft{yz'}{yz'l}}
                \strdxscale{2}{\strdbypassright{yz'}{yz'r}}
            }
        }
        %\strdscale{3}{3}{\strdbijection{yz'}{bj}}
        \strdcelllabel{z End}{f}
    }
}
\end{document}
